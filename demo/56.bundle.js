"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[56],{56:(e,t,n)=>{n.r(t),n.d(t,{clone:()=>d,findBoneTrackData:()=>u,getBoneByName:()=>c,getBones:()=>p,getEqualsBonesNames:()=>x,getHelperFromSkeleton:()=>s,getNearestBone:()=>m,getSkeletonOffsets:()=>a,renameBones:()=>l,retarget:()=>r,retargetClip:()=>i});var o=n(173);function r(e,t,n={}){const r=new o.Vector3,i=new o.Quaternion,s=new o.Vector3,a=new o.Matrix4,l=new o.Matrix4,m=new o.Matrix4;n.preserveMatrix=void 0===n.preserveMatrix||n.preserveMatrix,n.preservePosition=void 0===n.preservePosition||n.preservePosition,n.preserveHipPosition=void 0!==n.preserveHipPosition&&n.preserveHipPosition,n.useTargetMatrix=void 0!==n.useTargetMatrix&&n.useTargetMatrix,n.hip=void 0!==n.hip?n.hip:"hip",n.names=n.names||{};const u=t.isObject3D?t.skeleton.bones:p(t),x=e.isObject3D?e.skeleton.bones:p(e);let d,f,h,M,v;if(e.isObject3D?e.skeleton.pose():(n.useTargetMatrix=!0,n.preserveMatrix=!1),n.preservePosition){v=[];for(let e=0;e<x.length;e++)v.push(x[e].position.clone())}if(n.preserveMatrix){e.updateMatrixWorld(),e.matrixWorld.identity();for(let t=0;t<e.children.length;++t)e.children[t].updateMatrixWorld(!0)}if(n.offsets){d=[];for(let e=0;e<x.length;++e)f=x[e],h=n.names[f.name]||f.name,n.offsets[h]&&(f.matrix.multiply(n.offsets[h]),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()),d.push(f.matrixWorld.clone())}for(let t=0;t<x.length;++t){if(f=x[t],h=n.names[f.name]||f.name,M=c(h,u),m.copy(f.matrixWorld),M){if(M.updateMatrixWorld(),n.useTargetMatrix?l.copy(M.matrixWorld):(l.copy(e.matrixWorld).invert(),l.multiply(M.matrixWorld)),s.setFromMatrixScale(l),l.scale(s.set(1/s.x,1/s.y,1/s.z)),m.makeRotationFromQuaternion(i.setFromRotationMatrix(l)),e.isObject3D){const t=x.indexOf(f),n=d?d[t]:a.copy(e.skeleton.boneInverses[t]).invert();m.multiply(n)}m.copyPosition(l)}f.parent&&f.parent.isBone?(f.matrix.copy(f.parent.matrixWorld).invert(),f.matrix.multiply(m)):f.matrix.copy(m),n.preserveHipPosition&&h===n.hip&&f.matrix.setPosition(r.set(0,f.position.y,0)),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()}if(n.preservePosition)for(let e=0;e<x.length;++e)f=x[e],h=n.names[f.name]||f.name,h!==n.hip&&f.position.copy(v[e]);n.preserveMatrix&&e.updateMatrixWorld(!0)}function i(e,t,n,i={}){i.useFirstFramePosition=void 0!==i.useFirstFramePosition&&i.useFirstFramePosition,i.fps=void 0!==i.fps?i.fps:30,i.names=i.names||[],t.isObject3D||(t=s(t));const a=Math.round(n.duration*(i.fps/1e3)*1e3),l=1/i.fps,m=[],u=new o.AnimationMixer(t),x=p(e.skeleton),d=[];let f,h,M,v,y;u.clipAction(n).play(),u.update(0),t.updateMatrixWorld();for(let n=0;n<a;++n){const o=n*l;r(e,t,i);for(let e=0;e<x.length;++e)y=i.names[x[e].name]||x[e].name,M=c(y,t.skeleton),M&&(h=x[e],v=d[e]=d[e]||{bone:h},i.hip===y&&(v.pos||(v.pos={times:new Float32Array(a),values:new Float32Array(3*a)}),i.useFirstFramePosition&&(0===n&&(f=h.position.clone()),h.position.sub(f)),v.pos.times[n]=o,h.position.toArray(v.pos.values,3*n)),v.quat||(v.quat={times:new Float32Array(a),values:new Float32Array(4*a)}),v.quat.times[n]=o,h.quaternion.toArray(v.quat.values,4*n));u.update(l),t.updateMatrixWorld()}for(let e=0;e<d.length;++e)v=d[e],v&&(v.pos&&m.push(new o.VectorKeyframeTrack(".bones["+v.bone.name+"].position",v.pos.times,v.pos.values)),m.push(new o.QuaternionKeyframeTrack(".bones["+v.bone.name+"].quaternion",v.quat.times,v.quat.values)));return u.uncacheAction(n),new o.AnimationClip(n.name,-1,m)}function s(e){const t=new o.SkeletonHelper(e.bones[0]);return t.skeleton=e,t}function a(e,t,n={}){const r=new o.Vector3,i=new o.Vector3,a=new o.Vector3,l=new o.Vector3,u=new o.Vector2,x=new o.Vector2;n.hip=void 0!==n.hip?n.hip:"hip",n.names=n.names||{},t.isObject3D||(t=s(t));const d=Object.keys(n.names),f=Object.values(n.names),h=t.isObject3D?t.skeleton.bones:p(t),M=e.isObject3D?e.skeleton.bones:p(e),v=[];let y,b,g,w;for(e.skeleton.pose(),w=0;w<M.length;++w)if(y=M[w],g=n.names[y.name]||y.name,b=c(g,h),b&&g!==n.hip){const e=m(y.parent,d),t=m(b.parent,f);e.updateMatrixWorld(),t.updateMatrixWorld(),r.setFromMatrixPosition(e.matrixWorld),i.setFromMatrixPosition(y.matrixWorld),a.setFromMatrixPosition(t.matrixWorld),l.setFromMatrixPosition(b.matrixWorld),u.subVectors(new o.Vector2(i.x,i.y),new o.Vector2(r.x,r.y)).normalize(),x.subVectors(new o.Vector2(l.x,l.y),new o.Vector2(a.x,a.y)).normalize();const n=u.angle()-x.angle(),s=(new o.Matrix4).makeRotationFromEuler(new o.Euler(0,0,n));y.matrix.multiply(s),y.matrix.decompose(y.position,y.quaternion,y.scale),y.updateMatrixWorld(),v[g]=s}return v}function l(e,t){const n=p(e);for(let e=0;e<n.length;++e){const o=n[e];t[o.name]&&(o.name=t[o.name])}return this}function p(e){return Array.isArray(e)?e:e.bones}function c(e,t){for(let n=0,o=p(t);n<o.length;n++)if(e===o[n].name)return o[n]}function m(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}}function u(e,t){const n=/\[(.*)\]\.(.*)/,o={name:e};for(let r=0;r<t.length;++r){const i=n.exec(t[r].name);i&&e===i[1]&&(o[i[2]]=r)}return o}function x(e,t){const n=p(e),o=p(t),r=[];e:for(let e=0;e<n.length;e++){const t=n[e].name;for(let e=0;e<o.length;e++)if(t===o[e].name){r.push(t);continue e}}return r}function d(e){const t=new Map,n=new Map,o=e.clone();return f(e,o,(function(e,o){t.set(o,e),n.set(e,o)})),o.traverse((function(e){if(!e.isSkinnedMesh)return;const o=e,r=t.get(e),i=r.skeleton.bones;o.skeleton=r.skeleton.clone(),o.bindMatrix.copy(r.bindMatrix),o.skeleton.bones=i.map((function(e){return n.get(e)})),o.bind(o.skeleton,o.bindMatrix)})),o}function f(e,t,n){n(e,t);for(let o=0;o<e.children.length;o++)f(e.children[o],t.children[o],n)}}}]);